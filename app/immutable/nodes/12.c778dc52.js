var de=Object.defineProperty;var he=(a,t,r)=>t in a?de(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r;var X=(a,t,r)=>(he(a,typeof t!="symbol"?t+"":t,r),r);import{$ as Y,s as F,f as G,l as O,a as N,g as E,h as I,m as V,d as $,c as C,j as M,i as d,x as A,n as H,z as S,e as k,o as ge,a1 as be,Z as ye,y as ke}from"../chunks/scheduler.8e28fde2.js";import{S as q,i as x,b as h,d as g,m as b,a as _,t as p,e as y,g as R,c as j}from"../chunks/index.7310de3c.js";import{r as z,e as v,u as L,o as Z}from"../chunks/rbac.state.809eeacf.js";import{C as we}from"../chunks/Checkbox.17327d96.js";import{T as Pe,a as ve,b as Ne,c as ue,d as Ce,e as me}from"../chunks/TableHeadCell.c3b09e46.js";import{w as Se}from"../chunks/index.e56d8ce4.js";import{s as B}from"../chunks/client.c0def72b.js";import{a as De}from"../chunks/auth.state.082b92f3.js";import{n as Re}from"../chunks/toaster.state.4f2416aa.js";import{P as je,a as Te}from"../chunks/PageLayout.e01325d0.js";class Be{constructor(){X(this,"tableName","role_permissions")}async bulkCreate(t){try{const{data:r,error:e}=await B.from(this.tableName).insert(t).select();return e?(console.error(e),Promise.reject(`Creation of ${this.tableName} records failed, please try again.`)):Promise.resolve(r)}catch(r){return console.error(r),Promise.reject(`Creation of ${this.tableName} records failed, please try again.`)}}async bulkUpdate(t,r){try{const{data:e,error:o}=await B.from(this.tableName).upsert(t,r).select();return o?(console.error(o),Promise.reject(`Creation of ${this.tableName} records failed, please try again.`)):Promise.resolve(e)}catch(e){return console.error(e),Promise.reject(`Creation of ${this.tableName} records failed, please try again.`)}}async getAll(){try{const{data:t,error:r}=await B.from(this.tableName).select();return r?(console.error(r),Promise.reject(`Fetch of ${this.tableName} records failed, please try again.`)):Promise.resolve(t)}catch(t){return console.error(t),Promise.reject(`Fetch of ${this.tableName} records failed, please try again.`)}}async bulkDelete(t){try{const{error:r}=await B.from(this.tableName).delete().in("id",t);return r?(console.error(r),Promise.reject(`Deletion of ${this.tableName} record failed, please try again.`)):Promise.resolve()}catch(r){return console.error(r),Promise.reject(`Deletion of ${this.tableName} record failed, please try again.`)}}}const U=new Be,{store:{currentUser:Ae}}=De,{store:{rolePermissions:ee}}=z,{action:{toastify:te}}=Re;let D=null,P=null;const Ge=()=>(P=Se(!1),D={loading:P,upsertRolePermission:async(a,t)=>{P==null||P.set(!0);const r=Y(ee),e=Y(Ae),o=r.find(s=>s.permission_id===t&&s.role_id===a);let l="Create";try{if(o){l="Update";const s=[{...o,role_id:a,permission_id:t,updated_by_id:e==null?void 0:e.id,updated_at:new Date().toISOString(),on:!o.on}];await U.bulkUpdate(s,{onConflict:"uuid"})}else{l="Addition";const s=[{role_id:a,permission_id:t,created_by_id:e==null?void 0:e.id,created_at:new Date().toISOString(),updated_by_id:e==null?void 0:e.id,updated_at:new Date().toISOString(),on:!0}];await U.bulkCreate(s)}await ee.reload(),te({type:"success",message:`${l} of role permission successful`})}catch{te({type:"error",message:`${l} of role permission failed, please refresh browser and try again.`})}finally{P==null||P.set(!1)}}},D),Ee=()=>D===null?Ge():D,Ie=()=>{D=null,P=null};function re(a,t,r){const e=a.slice();return e[16]=t[r],e}function le(a,t,r){const e=a.slice();return e[19]=t[r],e}function oe(a,t,r){const e=a.slice();return e[19]=t[r],e}function Me(a){let t;return{c(){t=O("Permission")},l(r){t=V(r,"Permission")},m(r,e){d(r,t,e)},d(r){r&&$(t)}}}function Oe(a){let t=a[19].name+"",r;return{c(){r=O(t)},l(e){r=V(e,t)},m(e,o){d(e,r,o)},p(e,o){o&4&&t!==(t=e[19].name+"")&&H(r,t)},d(e){e&&$(r)}}}function se(a,t){let r,e,o;return e=new ue({props:{$$slots:{default:[Oe]},$$scope:{ctx:t}}}),{key:a,first:null,c(){r=k(),h(e.$$.fragment),this.h()},l(l){r=k(),g(e.$$.fragment,l),this.h()},h(){this.first=r},m(l,s){d(l,r,s),b(e,l,s),o=!0},p(l,s){t=l;const n={};s&16777220&&(n.$$scope={dirty:s,ctx:t}),e.$set(n)},i(l){o||(_(e.$$.fragment,l),o=!0)},o(l){p(e.$$.fragment,l),o=!1},d(l){l&&$(r),y(e,l)}}}function Ve(a){let t,r,e=[],o=new Map,l,s;t=new ue({props:{$$slots:{default:[Me]},$$scope:{ctx:a}}});let n=v(a[2]);const c=i=>i[19].name;for(let i=0;i<n.length;i+=1){let f=oe(a,n,i),m=c(f);o.set(m,e[i]=se(m,f))}return{c(){h(t.$$.fragment),r=N();for(let i=0;i<e.length;i+=1)e[i].c();l=k()},l(i){g(t.$$.fragment,i),r=C(i);for(let f=0;f<e.length;f+=1)e[f].l(i);l=k()},m(i,f){b(t,i,f),d(i,r,f);for(let m=0;m<e.length;m+=1)e[m]&&e[m].m(i,f);d(i,l,f),s=!0},p(i,f){const m={};f&16777216&&(m.$$scope={dirty:f,ctx:i}),t.$set(m),f&4&&(n=v(i[2]),R(),e=L(e,f,c,1,i,n,o,l.parentNode,Z,se,l,oe),j())},i(i){if(!s){_(t.$$.fragment,i);for(let f=0;f<n.length;f+=1)_(e[f]);s=!0}},o(i){p(t.$$.fragment,i);for(let f=0;f<e.length;f+=1)p(e[f]);s=!1},d(i){i&&($(r),$(l)),y(t,i);for(let f=0;f<e.length;f+=1)e[f].d(i)}}}function Fe(a){let t=a[16].description+"",r;return{c(){r=O(t)},l(e){r=V(e,t)},m(e,o){d(e,r,o)},p(e,o){o&2&&t!==(t=e[16].description+"")&&H(r,t)},d(e){e&&$(r)}}}function He(a){let t,r;function e(){return a[13](a[19],a[16])}return t=new we({props:{disabled:a[3],checked:a[9](a[19].id,a[16].id)}}),t.$on("click",e),{c(){h(t.$$.fragment)},l(o){g(t.$$.fragment,o)},m(o,l){b(t,o,l),r=!0},p(o,l){a=o;const s={};l&8&&(s.disabled=a[3]),l&6&&(s.checked=a[9](a[19].id,a[16].id)),t.$set(s)},i(o){r||(_(t.$$.fragment,o),r=!0)},o(o){p(t.$$.fragment,o),r=!1},d(o){y(t,o)}}}function ne(a,t){let r,e,o;return e=new me({props:{$$slots:{default:[He]},$$scope:{ctx:t}}}),{key:a,first:null,c(){r=k(),h(e.$$.fragment),this.h()},l(l){r=k(),g(e.$$.fragment,l),this.h()},h(){this.first=r},m(l,s){d(l,r,s),b(e,l,s),o=!0},p(l,s){t=l;const n={};s&16777230&&(n.$$scope={dirty:s,ctx:t}),e.$set(n)},i(l){o||(_(e.$$.fragment,l),o=!0)},o(l){p(e.$$.fragment,l),o=!1},d(l){l&&$(r),y(e,l)}}}function qe(a){let t,r,e=[],o=new Map,l,s;t=new me({props:{$$slots:{default:[Fe]},$$scope:{ctx:a}}});let n=v(a[2]);const c=i=>i[19].name;for(let i=0;i<n.length;i+=1){let f=le(a,n,i),m=c(f);o.set(m,e[i]=ne(m,f))}return{c(){h(t.$$.fragment),r=N();for(let i=0;i<e.length;i+=1)e[i].c();l=N()},l(i){g(t.$$.fragment,i),r=C(i);for(let f=0;f<e.length;f+=1)e[f].l(i);l=C(i)},m(i,f){b(t,i,f),d(i,r,f);for(let m=0;m<e.length;m+=1)e[m]&&e[m].m(i,f);d(i,l,f),s=!0},p(i,f){const m={};f&16777218&&(m.$$scope={dirty:f,ctx:i}),t.$set(m),f&782&&(n=v(i[2]),R(),e=L(e,f,c,1,i,n,o,l.parentNode,Z,ne,l,le),j())},i(i){if(!s){_(t.$$.fragment,i);for(let f=0;f<n.length;f+=1)_(e[f]);s=!0}},o(i){p(t.$$.fragment,i);for(let f=0;f<e.length;f+=1)p(e[f]);s=!1},d(i){i&&($(r),$(l)),y(t,i);for(let f=0;f<e.length;f+=1)e[f].d(i)}}}function ae(a,t){let r,e,o;return e=new Ce({props:{$$slots:{default:[qe]},$$scope:{ctx:t}}}),{key:a,first:null,c(){r=k(),h(e.$$.fragment),this.h()},l(l){r=k(),g(e.$$.fragment,l),this.h()},h(){this.first=r},m(l,s){d(l,r,s),b(e,l,s),o=!0},p(l,s){t=l;const n={};s&16777230&&(n.$$scope={dirty:s,ctx:t}),e.$set(n)},i(l){o||(_(e.$$.fragment,l),o=!0)},o(l){p(e.$$.fragment,l),o=!1},d(l){l&&$(r),y(e,l)}}}function xe(a){let t=[],r=new Map,e,o,l=v(a[1]);const s=n=>n[16].description;for(let n=0;n<l.length;n+=1){let c=re(a,l,n),i=s(c);r.set(i,t[n]=ae(i,c))}return{c(){for(let n=0;n<t.length;n+=1)t[n].c();e=k()},l(n){for(let c=0;c<t.length;c+=1)t[c].l(n);e=k()},m(n,c){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(n,c);d(n,e,c),o=!0},p(n,c){c&782&&(l=v(n[1]),R(),t=L(t,c,s,1,n,l,r,e.parentNode,Z,ae,e,re),j())},i(n){if(!o){for(let c=0;c<l.length;c+=1)_(t[c]);o=!0}},o(n){for(let c=0;c<t.length;c+=1)p(t[c]);o=!1},d(n){n&&$(e);for(let c=0;c<t.length;c+=1)t[c].d(n)}}}function ze(a){let t,r,e,o;return t=new ve({props:{$$slots:{default:[Ve]},$$scope:{ctx:a}}}),e=new Ne({props:{$$slots:{default:[xe]},$$scope:{ctx:a}}}),{c(){h(t.$$.fragment),r=N(),h(e.$$.fragment)},l(l){g(t.$$.fragment,l),r=C(l),g(e.$$.fragment,l)},m(l,s){b(t,l,s),d(l,r,s),b(e,l,s),o=!0},p(l,s){const n={};s&16777220&&(n.$$scope={dirty:s,ctx:l}),t.$set(n);const c={};s&16777230&&(c.$$scope={dirty:s,ctx:l}),e.$set(c)},i(l){o||(_(t.$$.fragment,l),_(e.$$.fragment,l),o=!0)},o(l){p(t.$$.fragment,l),p(e.$$.fragment,l),o=!1},d(l){l&&$(r),y(t,l),y(e,l)}}}function Le(a){let t,r,e,o,l,s;return l=new Pe({props:{$$slots:{default:[ze]},$$scope:{ctx:a}}}),{c(){t=G("div"),r=G("p"),e=O(a[0]),o=N(),h(l.$$.fragment),this.h()},l(n){t=E(n,"DIV",{class:!0});var c=I(t);r=E(c,"P",{class:!0});var i=I(r);e=V(i,a[0]),i.forEach($),o=C(c),g(l.$$.fragment,c),c.forEach($),this.h()},h(){M(r,"class","dark:text-white text-2xl"),M(t,"class","flex flex-col space-y-3")},m(n,c){d(n,t,c),A(t,r),A(r,e),A(t,o),b(l,t,null),s=!0},p(n,[c]){(!s||c&1)&&H(e,n[0]);const i={};c&16777230&&(i.$$scope={dirty:c,ctx:n}),l.$set(i)},i(n){s||(_(l.$$.fragment,n),s=!0)},o(n){p(l.$$.fragment,n),s=!1},d(n){n&&$(t),y(l)}}}function Ze(a,t,r){let e,o,l,s,n,c;const{store:{roles:i,permissions:f,rolePermissions:m}}=z;S(a,i,u=>r(12,n=u)),S(a,f,u=>r(11,s=u)),S(a,m,u=>r(14,l=u));const{loading:J,upsertRolePermission:_e}=Ee();S(a,J,u=>r(3,c=u));let{title:K}=t,{group_id:T}=t;const Q=async(u,w)=>_e(u,w),$e=(u,w)=>!!l.find(W=>W.permission_id===w&&W.role_id===u),pe=(u,w)=>Q(u.id,w.id);return a.$$set=u=>{"title"in u&&r(0,K=u.title),"group_id"in u&&r(10,T=u.group_id)},a.$$.update=()=>{a.$$.dirty&5120&&r(2,e=T?n.filter(u=>u.group_id===T):[]),a.$$.dirty&2048&&r(1,o=s.sort((u,w)=>!(w!=null&&w.sort_index)||!(u!=null&&u.sort_index)?0:u.sort_index-w.sort_index))},[K,o,e,c,i,f,m,J,Q,$e,T,s,n,pe]}class Je extends q{constructor(t){super(),x(this,t,Ze,Le,F,{title:0,group_id:10})}}function ie(a,t,r){const e=a.slice();return e[4]=t[r],e}function ce(a){let t,r,e=v(a[0]),o=[];for(let s=0;s<e.length;s+=1)o[s]=fe(ie(a,e,s));const l=s=>p(o[s],1,1,()=>{o[s]=null});return{c(){t=G("div");for(let s=0;s<o.length;s+=1)o[s].c();this.h()},l(s){t=E(s,"DIV",{class:!0});var n=I(t);for(let c=0;c<o.length;c+=1)o[c].l(n);n.forEach($),this.h()},h(){M(t,"class","flex flex-col space-y-8")},m(s,n){d(s,t,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(t,null);r=!0},p(s,n){if(n&1){e=v(s[0]);let c;for(c=0;c<e.length;c+=1){const i=ie(s,e,c);o[c]?(o[c].p(i,n),_(o[c],1)):(o[c]=fe(i),o[c].c(),_(o[c],1),o[c].m(t,null))}for(R(),c=e.length;c<o.length;c+=1)l(c);j()}},i(s){if(!r){for(let n=0;n<e.length;n+=1)_(o[n]);r=!0}},o(s){o=o.filter(Boolean);for(let n=0;n<o.length;n+=1)p(o[n]);r=!1},d(s){s&&$(t),ye(o,s)}}}function fe(a){let t,r,e,o;return r=new Je({props:{title:a[4].name,group_id:a[4].id}}),{c(){t=G("div"),h(r.$$.fragment),e=N(),this.h()},l(l){t=E(l,"DIV",{class:!0});var s=I(t);g(r.$$.fragment,s),e=C(s),s.forEach($),this.h()},h(){M(t,"class","flex flex-col space-y-3")},m(l,s){d(l,t,s),b(r,t,null),A(t,e),o=!0},p(l,s){const n={};s&1&&(n.title=l[4].name),s&1&&(n.group_id=l[4].id),r.$set(n)},i(l){o||(_(r.$$.fragment,l),o=!0)},o(l){p(r.$$.fragment,l),o=!1},d(l){l&&$(t),y(r)}}}function Ke(a){let t,r,e=a[0]&&a[0].length>0&&ce(a);return{c(){e&&e.c(),t=k()},l(o){e&&e.l(o),t=k()},m(o,l){e&&e.m(o,l),d(o,t,l),r=!0},p(o,[l]){o[0]&&o[0].length>0?e?(e.p(o,l),l&1&&_(e,1)):(e=ce(o),e.c(),_(e,1),e.m(t.parentNode,t)):e&&(R(),p(e,1,1,()=>{e=null}),j())},i(o){r||(_(e),r=!0)},o(o){p(e),r=!1},d(o){o&&$(t),e&&e.d(o)}}}function Qe(a,t,r){let e,o;const{store:{roleGroups:l,rolePermissions:s}}=z;return S(a,l,n=>r(2,o=n)),ge(s.reload),be(Ie),a.$$.update=()=>{a.$$.dirty&4&&r(0,e=o.sort((n,c)=>!(c!=null&&c.sort_index)||!(n!=null&&n.sort_index)?0:n.sort_index-c.sort_index))},[e,l,o]}class We extends q{constructor(t){super(),x(this,t,Qe,Ke,F,{})}}function Xe(a){let t,r;return t=new Te({props:{title:"Role Permissions"}}),{c(){h(t.$$.fragment)},l(e){g(t.$$.fragment,e)},m(e,o){b(t,e,o),r=!0},p:ke,i(e){r||(_(t.$$.fragment,e),r=!0)},o(e){p(t.$$.fragment,e),r=!1},d(e){y(t,e)}}}function Ye(a){let t,r;return t=new We({}),{c(){h(t.$$.fragment)},l(e){g(t.$$.fragment,e)},m(e,o){b(t,e,o),r=!0},i(e){r||(_(t.$$.fragment,e),r=!0)},o(e){p(t.$$.fragment,e),r=!1},d(e){y(t,e)}}}function Ue(a){let t,r;return t=new je({props:{title:"Role Permissions",$$slots:{body:[Ye],header:[Xe]},$$scope:{ctx:a}}}),{c(){h(t.$$.fragment)},l(e){g(t.$$.fragment,e)},m(e,o){b(t,e,o),r=!0},p(e,[o]){const l={};o&1&&(l.$$scope={dirty:o,ctx:e}),t.$set(l)},i(e){r||(_(t.$$.fragment,e),r=!0)},o(e){p(t.$$.fragment,e),r=!1},d(e){y(t,e)}}}class ut extends q{constructor(t){super(),x(this,t,null,Ue,F,{})}}export{ut as component};
