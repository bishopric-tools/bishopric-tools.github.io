import{V as se,s as ee,e as W,i as w,d as p,I as D,p as $e,f as A,a as O,g as N,h as z,c as B,j as F,y as U,z as we,W as ve,S as be,l as Q,m as X,O as ke,n as ye,H as K,w as re,U as De}from"../chunks/scheduler.eb33ae00.js";import{S as te,i as ae,a as b,g as le,t as h,c as oe,h as ge,b as S,d as R,m as C,e as I}from"../chunks/index.3134e3af.js";import{S as Se,r as ie,D as ce,a as de,b as Re,c as Ce}from"../chunks/types.a79c38c9.js";import{w as H}from"../chunks/index.70276595.js";import{a as Ie}from"../chunks/auth.state.31e9e48b.js";import{n as Te}from"../chunks/toaster.state.37fd4f23.js";import{C as Ae,c as Ne}from"../chunks/CloseButton.842d62f7.js";import{D as Ue}from"../chunks/Drawer.0a33e861.js";import{B as Z}from"../chunks/Button.b81df063.js";import{f as Ee,c as Pe,a as Ve,T as xe}from"../chunks/TextField.7d592578.js";let k=null;const Le=()=>(k={drawerClosed:H(!0),focusedUser:H(null),closeDrawer:()=>{var s,e;k&&((e=(s=k==null?void 0:k.drawerClosed)==null?void 0:s.set)==null||e.call(s,!0))},openDrawer:()=>{var s,e;k&&((e=(s=k==null?void 0:k.drawerClosed)==null?void 0:s.set)==null||e.call(s,!1))}},k),Oe=()=>{k=null},fe=()=>k||Le();class Be extends Se{constructor(){super("roles")}}const ne=new Be,{store:{currentUser:me}}=Ie,{store:{roles:Fe}}=ie,{action:{toastify:M}}=Te,qe={name:""},ze={name:""};let L=null;const je=()=>(L={loading:H(!1),model:H(ze),action:H("view"),targetRole:H(qe),addRole:async s=>{var e,a,t,n;try{let o=s.sort_index;s.sort_index||(o=(((e=se(Fe).sort((l,i)=>!(i!=null&&i.sort_index)||!(l!=null&&l.sort_index)?0:i.sort_index-l.sort_index)[1])==null?void 0:e.sort_index)??0)+1);const r=[{name:s.name,sort_index:o,created_by_id:(a=se(me))==null?void 0:a.id,created_at:new Date().toISOString()}];await ne.bulkCreate(r),(n=(t=L==null?void 0:L.targetRole)==null?void 0:t.set)==null||n.call(t,null),M({type:"success",message:"Updated role successfully"})}catch{M({type:"error",message:"Update role failed, please refresh browser and try again."})}},updateRole:async s=>{var e;try{const a=[{name:s.name,uuid:s.uuid,updated_by_id:(e=se(me))==null?void 0:e.id,updated_at:new Date().toISOString()}];await ne.bulkUpdate(a,{onConflict:"uuid"}),M({type:"success",message:"Updated role successfully."})}catch{M({type:"error",message:"Update role failed, please refresh browser and try again."})}},deleteRole:async s=>{if(s)try{await ne.bulkDelete([s]),M({type:"success",message:"Deleted role successfully."})}catch{M({type:"error",message:"Delete role failed, please refresh browser and try again."})}}},L),he=()=>L===null?je():L,Me=()=>{L=null};function pe(s){var $,J,Y;let e,a,t,n,o,r,f,l,i,u,g,v,E,P,q;function G(d){s[14](d)}let j={type:"text",name:"role-name",label:"Name",placeholder:"Name",disabled:s[2],isInvalid:(($=s[3])==null?void 0:$.name)!==void 0,helperMessage:(Y=(J=s[3])==null?void 0:J.name)==null?void 0:Y.message,novalidate:!0,required:!0};s[1].name!==void 0&&(j.value=s[1].name),t=new xe({props:j}),$e.push(()=>ge(t,"value",G)),t.$on("input",s[11]);let m=s[0]!=="add"&&_e(s);return u=new Z({props:{type:"button",size:"xs",class:"mr-4",color:"alternative",disabled:s[2],$$slots:{default:[Ke]},$$scope:{ctx:s}}}),u.$on("click",s[10]),v=new Z({props:{type:"button",size:"xs",disabled:s[2],$$slots:{default:[Je]},$$scope:{ctx:s}}}),v.$on("click",s[12]),{c(){e=A("form"),a=A("div"),S(t.$$.fragment),o=O(),r=A("div"),f=A("div"),m&&m.c(),l=O(),i=A("div"),S(u.$$.fragment),g=O(),S(v.$$.fragment),this.h()},l(d){e=N(d,"FORM",{class:!0});var _=z(e);a=N(_,"DIV",{class:!0});var y=z(a);R(t.$$.fragment,y),y.forEach(p),o=B(_),r=N(_,"DIV",{class:!0});var T=z(r);f=N(T,"DIV",{});var V=z(f);m&&m.l(V),V.forEach(p),l=B(T),i=N(T,"DIV",{});var x=z(i);R(u.$$.fragment,x),g=B(x),R(v.$$.fragment,x),x.forEach(p),T.forEach(p),_.forEach(p),this.h()},h(){F(a,"class","mb-6"),F(r,"class","flex justify-between mt-4"),e.noValidate=!0,F(e,"class","mb-6")},m(d,_){w(d,e,_),U(e,a),C(t,a,null),U(e,o),U(e,r),U(r,f),m&&m.m(f,null),U(r,l),U(r,i),C(u,i,null),U(i,g),C(v,i,null),E=!0,P||(q=we(e,"submit",ve(s[13])),P=!0)},p(d,_){var x,c,ue;const y={};_&4&&(y.disabled=d[2]),_&8&&(y.isInvalid=((x=d[3])==null?void 0:x.name)!==void 0),_&8&&(y.helperMessage=(ue=(c=d[3])==null?void 0:c.name)==null?void 0:ue.message),!n&&_&2&&(n=!0,y.value=d[1].name,be(()=>n=!1)),t.$set(y),d[0]!=="add"?m?(m.p(d,_),_&1&&b(m,1)):(m=_e(d),m.c(),b(m,1),m.m(f,null)):m&&(le(),h(m,1,1,()=>{m=null}),oe());const T={};_&4&&(T.disabled=d[2]),_&33554432&&(T.$$scope={dirty:_,ctx:d}),u.$set(T);const V={};_&4&&(V.disabled=d[2]),_&33554437&&(V.$$scope={dirty:_,ctx:d}),v.$set(V)},i(d){E||(b(t.$$.fragment,d),b(m),b(u.$$.fragment,d),b(v.$$.fragment,d),E=!0)},o(d){h(t.$$.fragment,d),h(m),h(u.$$.fragment,d),h(v.$$.fragment,d),E=!1},d(d){d&&p(e),I(t),m&&m.d(),I(u),I(v),P=!1,q()}}}function _e(s){let e,a;return e=new Z({props:{type:"button",size:"xs",color:"red",disabled:s[2],$$slots:{default:[He]},$$scope:{ctx:s}}}),e.$on("click",s[15]),{c(){S(e.$$.fragment)},l(t){R(e.$$.fragment,t)},m(t,n){C(e,t,n),a=!0},p(t,n){const o={};n&4&&(o.disabled=t[2]),n&33554432&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){a||(b(e.$$.fragment,t),a=!0)},o(t){h(e.$$.fragment,t),a=!1},d(t){I(e,t)}}}function He(s){let e;return{c(){e=Q("Delete")},l(a){e=X(a,"Delete")},m(a,t){w(a,e,t)},d(a){a&&p(e)}}}function Ke(s){let e;return{c(){e=Q("Reset")},l(a){e=X(a,"Reset")},m(a,t){w(a,e,t)},d(a){a&&p(e)}}}function We(s){let e=s[0]==="add"?"Add":"Update",a;return{c(){a=Q(e)},l(t){a=X(t,e)},m(t,n){w(t,a,n)},p(t,n){n&1&&e!==(e=t[0]==="add"?"Add":"Update")&&ye(a,e)},d(t){t&&p(a)}}}function Ge(s){let e;return{c(){e=Q("...")},l(a){e=X(a,"...")},m(a,t){w(a,e,t)},p:K,d(a){a&&p(e)}}}function Je(s){let e;function a(o,r){return o[2]?Ge:We}let t=a(s),n=t(s);return{c(){n.c(),e=W()},l(o){n.l(o),e=W()},m(o,r){n.m(o,r),w(o,e,r)},p(o,r){t===(t=a(o))&&n?n.p(o,r):(n.d(1),n=t(o),n&&(n.c(),n.m(e.parentNode,e)))},d(o){o&&p(e),n.d(o)}}}function Qe(s){let e,a,t=s[1]&&pe(s);return{c(){t&&t.c(),e=W()},l(n){t&&t.l(n),e=W()},m(n,o){t&&t.m(n,o),w(n,e,o),a=!0},p(n,[o]){n[1]?t?(t.p(n,o),o&2&&b(t,1)):(t=pe(n),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(le(),h(t,1,1,()=>{t=null}),oe())},i(n){a||(b(t),a=!0)},o(n){h(t),a=!1},d(n){n&&p(e),t&&t.d(n)}}}function Xe(s,e,a){let t,n,o,r,f,l;const{loading:i,targetRole:u,model:g,action:v,addRole:E,updateRole:P,deleteRole:q}=he();D(s,i,c=>a(2,f=c)),D(s,u,c=>a(16,t=c)),D(s,g,c=>a(1,o=c)),D(s,v,c=>a(0,n=c));const{closeDrawer:G}=fe(),{store:{roles:j}}=ie,{errors:m,submitted:$,validate:J,reset:Y}=Ee(Pe({name:Ve().required("Name is required").label("Name")}));D(s,m,c=>a(3,l=c)),D(s,$,c=>a(17,r=c));const d=()=>{t&&g.set({name:t.name}),$.set(!1),Y()},_=async()=>{if(!r)return;const{name:c}=o;await J({name:c})},y=async()=>{try{i.set(!0),$.set(!0);const{name:c}=o;switch(await J({name:c}),n){case"add":await E({...t,name:c});break;case"update":await P({...t,name:c});break;case"delete":t!=null&&t.id&&await q(t.id);break;default:}await j.reload(),G()}catch(c){console.log("submit failed",c)}finally{i.set(!1)}};u.subscribe(c=>{c&&g.set({name:c.name})});function T(c){ke.call(this,s,c)}function V(c){s.$$.not_equal(o.name,c)&&(o.name=c,g.set(o))}return[n,o,f,l,i,u,g,v,m,$,d,_,y,T,V,()=>{v.set("delete"),y()}]}class Ye extends te{constructor(e){super(),ae(this,e,Xe,Qe,ee,{})}}function Ze(s){let e,a,t="User",n,o,r,f,l;return o=new Ae({props:{class:"mb-4 dark:text-white"}}),o.$on("click",s[3]),f=new Ye({}),{c(){e=A("div"),a=A("h5"),a.textContent=t,n=O(),S(o.$$.fragment),r=O(),S(f.$$.fragment),this.h()},l(i){e=N(i,"DIV",{class:!0});var u=z(e);a=N(u,"H5",{id:!0,class:!0,"data-svelte-h":!0}),re(a)!=="svelte-tpi0tj"&&(a.textContent=t),n=B(u),R(o.$$.fragment,u),u.forEach(p),r=B(i),R(f.$$.fragment,i),this.h()},h(){F(a,"id","drawer-label"),F(a,"class","inline-flex items-center mb-6 text-base font-semibold text-gray-500 uppercase dark:text-gray-400"),F(e,"class","flex items-center")},m(i,u){w(i,e,u),U(e,a),U(e,n),C(o,e,null),w(i,r,u),C(f,i,u),l=!0},p:K,i(i){l||(b(o.$$.fragment,i),b(f.$$.fragment,i),l=!0)},o(i){h(o.$$.fragment,i),h(f.$$.fragment,i),l=!1},d(i){i&&(p(e),p(r)),I(o),I(f,i)}}}function et(s){let e,a,t;function n(r){s[4](r)}let o={transitionType:"fly",transitionParams:s[1],id:"sidebar4",placement:"right",$$slots:{default:[Ze]},$$scope:{ctx:s}};return s[0]!==void 0&&(o.hidden=s[0]),e=new Ue({props:o}),$e.push(()=>ge(e,"hidden",n)),{c(){S(e.$$.fragment)},l(r){R(e.$$.fragment,r)},m(r,f){C(e,r,f),t=!0},p(r,[f]){const l={};f&32&&(l.$$scope={dirty:f,ctx:r}),!a&&f&1&&(a=!0,l.hidden=r[0],be(()=>a=!1)),e.$set(l)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){h(e.$$.fragment,r),t=!1},d(r){I(e,r)}}}function tt(s,e,a){let t,n={x:320,duration:200,easing:Ne};const{drawerClosed:o,closeDrawer:r}=fe();D(s,o,l=>a(0,t=l));function f(l){t=l,o.set(t)}return[t,n,o,r,f]}class at extends te{constructor(e){super(),ae(this,e,tt,et,ee,{})}}function st(s){let e,a="No data";return{c(){e=A("p"),e.textContent=a},l(t){e=N(t,"P",{"data-svelte-h":!0}),re(e)!=="svelte-t5me1l"&&(e.textContent=a)},m(t,n){w(t,e,n)},p:K,i:K,o:K,d(t){t&&p(e)}}}function nt(s){let e,a,t,n,o,r,f;return a=new Z({props:{color:"green",size:"xs",$$slots:{default:[rt]},$$scope:{ctx:s}}}),a.$on("click",s[8]),n=new Re({props:{options:s[0],data:s[2],loading:s[3]}}),r=new at({}),{c(){e=A("div"),S(a.$$.fragment),t=O(),S(n.$$.fragment),o=O(),S(r.$$.fragment),this.h()},l(l){e=N(l,"DIV",{class:!0});var i=z(e);R(a.$$.fragment,i),i.forEach(p),t=B(l),R(n.$$.fragment,l),o=B(l),R(r.$$.fragment,l),this.h()},h(){F(e,"class","w-full flex justify-end mb-4")},m(l,i){w(l,e,i),C(a,e,null),w(l,t,i),C(n,l,i),w(l,o,i),C(r,l,i),f=!0},p(l,i){const u={};i&65536&&(u.$$scope={dirty:i,ctx:l}),a.$set(u);const g={};i&1&&(g.options=l[0]),i&4&&(g.data=l[2]),i&8&&(g.loading=l[3]),n.$set(g)},i(l){f||(b(a.$$.fragment,l),b(n.$$.fragment,l),b(r.$$.fragment,l),f=!0)},o(l){h(a.$$.fragment,l),h(n.$$.fragment,l),h(r.$$.fragment,l),f=!1},d(l){l&&(p(e),p(t),p(o)),I(a),I(n,l),I(r,l)}}}function rt(s){let e;return{c(){e=Q("+")},l(a){e=X(a,"+")},m(a,t){w(a,e,t)},d(a){a&&p(e)}}}function lt(s){let e,a,t,n;const o=[nt,st],r=[];function f(l,i){return l[0]&&l[1]&&l[1].length>0?0:1}return e=f(s),a=r[e]=o[e](s),{c(){a.c(),t=W()},l(l){a.l(l),t=W()},m(l,i){r[e].m(l,i),w(l,t,i),n=!0},p(l,[i]){let u=e;e=f(l),e===u?r[e].p(l,i):(le(),h(r[u],1,1,()=>{r[u]=null}),oe(),a=r[e],a?a.p(l,i):(a=r[e]=o[e](l),a.c()),b(a,1),a.m(t.parentNode,t))},i(l){n||(b(a),n=!0)},o(l){h(a),n=!1},d(l){l&&p(t),r[e].d(l)}}}function ot(s,e,a){let t,n,o,r;const{store:{roles:f}}=ie;D(s,f,$=>a(1,n=$));const{openDrawer:l}=fe(),{targetRole:i,action:u}=he(),{loading:g}=f;D(s,g,$=>a(3,r=$));const v={onRowClick:$=>{u.set("update"),l(),i.set($)},columnDefs:[{label:"Name",dataProperty:"name",dataType:ce.String,viewAlignment:de.Left},{label:"Sort Index",dataProperty:"sort_index",dataType:ce.String,viewAlignment:de.Left}]},E=Ce(v),{store:{options:P,data:q},actions:{setRowData:G}}=E;D(s,P,$=>a(0,t=$)),D(s,q,$=>a(2,o=$));const j=()=>{u.set("add"),l()},m=f.subscribe($=>{G($)});return De(()=>{m(),Oe(),Me()}),[t,n,o,r,f,g,P,q,j]}class it extends te{constructor(e){super(),ae(this,e,ot,lt,ee,{})}}function ft(s){let e,a="Roles",t,n,o;return n=new it({}),{c(){e=A("p"),e.textContent=a,t=O(),S(n.$$.fragment),this.h()},l(r){e=N(r,"P",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-4f94pi"&&(e.textContent=a),t=B(r),R(n.$$.fragment,r),this.h()},h(){F(e,"class","text-base dark:text-white")},m(r,f){w(r,e,f),w(r,t,f),C(n,r,f),o=!0},p:K,i(r){o||(b(n.$$.fragment,r),o=!0)},o(r){h(n.$$.fragment,r),o=!1},d(r){r&&(p(e),p(t)),I(n,r)}}}class wt extends te{constructor(e){super(),ae(this,e,null,ft,ee,{})}}export{wt as component};
