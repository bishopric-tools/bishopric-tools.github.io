import{A as _,s as d}from"./client.b4058d88.js";import{w as S}from"./index.91f33279.js";import{N as p}from"./scheduler.93423757.js";import{j as v}from"./singletons.ae89dcfe.js";class T{set(s,t){try{return localStorage.setItem(s,JSON.stringify(t)),!0}catch(u){return console.error("Failed to set data in localStorage",u),!1}}get(s){try{const t=localStorage.getItem(s);return t?JSON.parse(t):null}catch(t){return console.error("Failed to get data from localStorage",t),null}}delete(s){try{return localStorage.removeItem(s),!0}catch(t){return console.error("Failed to delete data from localStorage",t),!1}}exists(s){return localStorage.getItem(s)!==null}clear(){try{return localStorage.clear(),!0}catch(s){return console.error("Failed to clear localStorage",s),!1}}}const U=new T,k=()=>{const e=S(),s=S([]),t=i=>{const f={...i,duration:i.duration===void 0?7e3:i.duration};s.update(h=>(h.push(f),h))};let u=!1;const P=()=>{const i=p(s);if(i!=null&&i.length){const f=p(s)[0];e.set(f),setTimeout(()=>{i.shift(),s.set(i),P()},f.duration)}else e.set(null),u=!1};return s.subscribe(()=>{u||(u=!0,P())}),{store:{alert:e},actions:{log:t,reset:()=>{e.set(null),s.set([])}}}},b=k(),{APP_BASE_URL:w,SUPABASE_URL:A}=_,{actions:{log:r}}=b,R=()=>{const e=S(!1),s=S(null),t=S(null),u=A.split(".")[0].split("//")[1].split(":")[0];return{store:{loading:e,currentUser:s,currentSession:t},actions:{isAuthenticated:()=>{if(p(s))return Promise.resolve(!0);{const a=U.get(`sb-${u}-auth-token`);if(a){const{user:o}=a;o&&s.set(o)}}return Promise.resolve(!!p(s))},signIn:async(a,o)=>{e.set(!0);try{const c={email:a,password:o},{data:n,error:m}=await d.auth.signInWithPassword(c);if(m)return r({message:"Sign credentials in failed, please try again.",state:"error"}),e.set(!1),Promise.reject("Sign in failed");t.set(null),s.set(null);const{session:g,user:l}=n;return g&&t.set(g),l&&s.set(l),e.set(!1),r({message:"Sign in successful ... redirecting",state:"success"}),Promise.resolve({success:!0,message:"Sign In Successful",data:n})}catch{return r({message:"Sign in failed",state:"error"}),e.set(!1),Promise.reject("Sign in failed")}},signOut:async()=>{e.set(!0);try{const{error:a}=await d.auth.signOut({scope:"global"});return t.set(null),s.set(null),a?(r({message:"Sign out failed",state:"error"}),e.set(!1),Promise.reject("Sign out failed")):(e.set(!1),Promise.resolve({success:!0,message:"Sign Out Successful"}))}catch{return r({message:"Sign out failed",state:"error"}),e.set(!1),Promise.reject("Sign out failed")}},signUp:async(a,o)=>{e.set(!0);try{const c={email:a,password:o,options:{emailRedirectTo:w}},{data:n,error:m}=await d.auth.signUp(c);if(m)return r({message:"Sign up failed",state:"error"}),e.set(!1),Promise.reject("Sign up failed");const{session:g,user:l}=n;return g&&t.set(g),l&&s.set(l),e.set(!1),r({message:"Sign up successful, check your email for an account confirmation link",state:"success"}),Promise.resolve({success:!0,message:"signUp Successful",data:n})}catch{return r({message:"Sign up failed",state:"error"}),Promise.reject("Sign up failed")}},triggerResetPassword:async a=>{e.set(!1);try{const o={redirectTo:`${w}/auth/update-password`},{data:c,error:n}=await d.auth.resetPasswordForEmail(a,o);return n?(r({message:"Trigger password reset failed",state:"error"}),e.set(!1),Promise.reject("Trigger password reset failed")):(e.set(!1),r({message:"Trigger password reset successful, check your email for password reset link",state:"success"}),Promise.resolve({success:!0,message:"Trigger password reset successful",data:c}))}catch{return r({message:"Trigger password reset failed",state:"error"}),e.set(!1),Promise.reject("Trigger password reset failed")}},resetPassword:async a=>{var o,c;e.set(!0);try{const{data:n,error:m}=await d.auth.getSession();if(m)return r({message:"Password reset failed",state:"error"}),e.set(!1),Promise.reject("Password reset failed");await d.auth.setSession({access_token:((o=n.session)==null?void 0:o.access_token)||"",refresh_token:((c=n.session)==null?void 0:c.refresh_token)||""});const g={emailRedirectTo:w},{data:l,error:I}=await d.auth.updateUser({password:a},g);if(I)return r({message:"Password reset failed",state:"error"}),e.set(!1),Promise.reject("Password reset failed");const{user:y}=l;return y&&s.set(y),e.set(!1),r({message:"Success, your password has been reset.",state:"success"}),Promise.resolve({success:!0,message:"Password Reset Successful",data:l})}catch{return r({message:"Password reset failed",state:"error"}),e.set(!1),Promise.reject("Password reset failed")}}}}},D=R(),$=v("goto");export{D as a,b,$ as g};
